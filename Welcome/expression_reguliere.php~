<?php
	session_start();
$bdd = new PDO('mysql:host=localhost;dbname=network', 'upjv', 'upjv2021');

if (isset($_POST['inscrip']))
{
	if ((!empty($_POST['Prenom'])) && (!empty($_POST['Nom'])) && (!empty($_POST['email'])) && (!empty($_POST['telephone'])) && (!empty($_POST['mp'])) && (!empty($_POST['cmp'])))
	{
		   $nom = htmlspecialchars($_POST['Nom']);
		   $prenom = htmlspecialchars($_POST['Prenom']);
		   $email = htmlspecialchars($_POST['email']);
		  
		   $telephone = htmlspecialchars($_POST['telephone']);
		   $mp = ($_POST['mp']);
		   $cmp = ($_POST['cmp']);

		if (preg_match("/[a-zA-Z]{2}/",$_POST['Prenom'])==1)
		{
			/*echo "ok";*/
				if (preg_match("/[a-zA-Z]{2}/",$_POST['Nom'])==1)
				{
					/*echo "ok";*/
						if (preg_match("/[a-z]+@(([[:alnum:]]+[.])+)+[a-z]{2,3}/",$_POST['email'])==1)
						{
							/*echo "ok";*/
								if (preg_match("/([06]|[07])[0-9]{8}$/",$_POST['telephone'])==1)
								{
									/*echo "ok";*/
										if (preg_match("/^(?=.*[A-z])(?=.*[A-Z])(?=.*[0-9])/",$_POST['mp']))
										{
											/*echo "ok";*/
										
												if ($_POST['mp']==$_POST['cmp'])
												{
													$insertmbr = $bdd->prepare("INSERT INTO membres(nom, prenom, mail, mdp) VALUES(?, ?, ?, ?)");
													$insertmbr->execute(array($nom,$prenom, $email, $mp));
												  header('Location: ../CreateNewAccount/CreateNewAccount.php?id='. $_SESSION['id']);
												}
												else
												{
													echo "<font color='red'>Mot de passe de confirmation non identique";
												}
										}
										else
										{
											echo "<font color='red'>Le mot de passe doit contenir au moins 7 caractère,dont une majuscule,une minuscule et un chiffre";
										}
								}
								else
								{
									echo "<font color='red'>Numéro de téléphone non conforme";
								}
						}
						else
						{
							echo "<font color='red'>Email non conforme";
						}
				}
				else
				{
					echo "<font color='red'>Nom non conforme";
				}
		}
		else
		{
			echo "<font color='red'>Prénom non conforme";
		}
	}
	else
	{
		echo "<font color='red'>Veuillez renseignez tout les champs";

	}
}

if (isset($_POST['dinscrp']))
{
	header("Location: /site4/Connexion/Connexion.php");
}
?>